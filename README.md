StormBit VPN Management Interface
===========

What the heck is it?
---------------------

It's a management interface for our VPN service. It allows users to register, login, and download their generated client config and keys.

Why? Isn't there stuff out there that does just that?
-----------------

Yes, there is. We wanted to put together our own software, and make it available to those who want it, be it some business, or just a community like us looking for some solution.

How do I work this thing?!
---------------

1. Get your server set up. If you're on a Debian or Ubuntu machine:

####/etc/openvpn/server.conf

	mode server
	tls-server
	port 52 #Change this
	proto udp
	dev tap
	persist-key
	persist-tun
	ca /etc/openvpn/easy-rsa/2.0/keys/ca.crt
	cert /etc/openvpn/easy-rsa/2.0/keys/server.crt
	key /etc/openvpn/easy-rsa/2.0/keys/server.key
	dh /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem
	#tls-auth /etc/openvpn/easy-rsa/2.0/keys/ta.key 0
	cipher BF-CBC
	comp-lzo
	ifconfig 10.8.0.1 10.8.0.2
	server 10.8.0.0 255.255.255.252
	push "redirect-gateway def1 bypass-dhcp"
	push "dhcp-option DNS 8.8.8.8"
	push "dhcp-option DNS 8.8.4.4"
	push "dhcp-option WINS 10.8.0.1" #If you want a WINS server (samba) setup and visible in the VPN, set this!
	push "dhcp-option DOMAIN supernova.arghargh200.net"  #Change this!
	keepalive 10 120
	status /var/log/openvpn-status.log
	log-append /etc/openvpn/server.log
	verb 3
	duplicate-cn #Allows our clients to use multiple clients at a time with one key.
	client-to-client #allows our clients to talk to each other
	comp-lzo
	crl-verify /etc/openvpn/easy-rsa/2.0/keys/crl.pem #IMPORTANT! This is used for banning users and revoking their keys!

####An average directory structure

	/etc/openvpn/
		easy-rsa/
			1.0/ <irrelevant>
			2.0/
				build-ca
				build-dh
				build-key
				build-key-server
				clean-all
				usermgmt.sh -- Likely to be deprecated in the future.
				vpndata.json -- generated by site script. Contains hashed login information and user information.
				keys/
					ca.crt			-- created during server setup. THIS one goes with clients.
					ca.key			-- created during server setup. Do not leave this accessible to the public!
					dh512.pem		-- created during server setup. May be dh1024.pem or something like that. Make sure you check!
					server.crt		-- created during server setup
					server.csr		-- created during server setup
					server.key		-- created during server setup
					<other files>
				vars -- Edit to change default values
				<other files>
		server.conf -- See Server Config section
		<other files>

####Generating server configurations and certificates.

	cd /etc/openvpn/easy-rsa/2.0/
	Edit ./vars AND usermgmt.sh so that both sets of variables MATCH! Not doing so can cause issues!
	Then:
	source ./vars
	./clean-all
	./build-ca
	./build-dh
	openvpn --genkey --secret keys/ta.key
	./build-key-server server

####Setting up StormBitVPN MI

*  Copy the index.php script to a desired location. You can change the name if you wish.

*  Copy the usermgmt.sh backend script to your easy-rsa/2.0 folder and make it executable (chmod +x usrmgmt.sh)

*  Edit usermgmt.sh to match the variables within /etc/openvpn/easy-rsa/2.0/vars

*  Start your server! You may need to make and then revoke a key to get it to start:


		./usermgmt.sh revoked-test revoked@test
		./usermgmt.sh revoked-test --delete

Sources and helpful links
---------------
General setup: [DigitalOcean's Debian 6 Guide](https://www.digitalocean.com/community/articles/how-to-setup-and-configure-an-openvpn-server-on-debian-6)

Android Client Certification File setup: [OpenVPN Forums' Thread](https://forums.openvpn.net/topic9062.html)

Configuration files: My own, sanitized and changed.

Some extra configuration ideas: [Sachin Sharma's OpenVPN on CentOS guide.](http://sachinsharm.wordpress.com/2013/08/09/installationsetup-and-configure-an-openvpn-server-on-centosrhel-6-3/)

Helpful tips and additional parts (Includes WINS client setup!): [Christoph's OpenVPN Mini-FAQ](https://workaround.org/openvpn-faq)
